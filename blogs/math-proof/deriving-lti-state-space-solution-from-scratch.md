# Re0: 线性常系数微分方程的通解推导

在求解状态空间模型（State Space Models）中的一个公式时，遇到了如下的问题
$$
\dfrac{\mathrm{d} h}{\mathrm{d} t} = A h(t) + B x(t)
$$
其中 $x(t)$ 是输入，$t$ 是时间. 

这是一个来自现实世界问题的微分方程，如果我们直接动用高数的知识很快就能得到**线性常系数常微分方程**的通解. 正如了解并学会某个知识很容易，但是理解它如何来的，即背后的思维往往更重要. 

先从一个更简单的形式来看，比如先让 $B=0$，这样原微分方程化为
$$
\dfrac{\mathrm{d} h}{\mathrm{d} t} - A h(t) = 0
$$
我们一定要明确，求解微分方程的目的，是为了获得被微分的那个函数的原来的形式，这里也就是 $h(t)$ 的表达式. 

换句话说，如果我们能把微分方程凑成类似 $\dfrac{\mathrm{d} F(t)}{\mathrm{d} t} = 0$ 的形式，就能通过两侧同时积分得到其解. 

观察微分方程，最令人注意到的是，$F(t)$ 微分后的结果既包括 $h(t)$ 本身，也包括了其导数 $h'(t)$，回想链式求导法则中的**“前导后不导，前不导后导”**，顺着这个思路我们可以大胆猜测原函数 $F(t)$ 其实包含了 $u(t)h(t)$ 两项，因为这样就有
$$
F'(t) = u'(t) h(t) + u(t) h'(t) = 0
$$
对比一下原来的微分方程，发现差了常数 $A$，其实我们可以视其为常数，因为它不包含自变量 $t$，这样我们把上式两侧都乘 $A$，有
$$
A u'(t) h(t) + A u(t) h'(t) = 0
$$
我们发现，和原来的微分方程相比，已经很接近了，只不过 $A u'(t) h(t)$ 多了个 $u'(t)$，把方程两边同时除以 $-u'(t)$ 即可，这样负号也配平了
$$
\underbrace{-A h(t) }_{完全相同了} -A \dfrac{u(t)}{u'(t)} h'(t) = 0 \quad u'(t) \neq 0
$$
现在的问题就转化为 $-A \dfrac{u(t)}{u'(t)} h'(t)$ 这项了，原始的微分方程这里是 $h'(t)$，那么也就是说必须使得 $-A \dfrac{u(t)}{u'(t)} = 1$

接下来就是猜测这个 $u(t)$ 长什么样子，根据分式，这就要求一个函数自身和他的导函数必须成比例，这样才能把式子约掉，我们可以按个尝试基本初等函数中的一些函数 $t^n$，$\sin(t)$，$\ln(t)$，发现都不行，只有指数函数 $e^{t}$ 有类似的性质，因为它的导数就是它本身. 

但这样还差个 $A$，我们知道，如果函数是 $e^{kt}$，这样导数就可以下来一个 $k$，这样就可以把原来的 $A$ 约掉，所以显然我们可以让 $u(t)=e^{-At}$，这样
$$
-A \dfrac{u(t)}{u'(t)} = -A \dfrac{e^{-At}}{-Ae^{-At}} = 1
$$
当然有人说，那万一是 $u(t)=e^{-At+C}$ 呢？你可以自行计算一下，发现这个 $e^C$ 和分母中的导数同样也含有 $e^C$，又可以约掉. 因此无论如何，多个 $C$ 少个 $C$ 都没有问题. 

从而，我们有
$$
\dfrac{\mathrm{d} h}{\mathrm{d} t} - A h(t) = 0 \implies \dfrac{\mathrm{d}}{\mathrm{d} t} (u(t)h(t)) = \dfrac{\mathrm{d}}{\mathrm{d} t} \left(e^{-At}h(t) \right) = 0
$$
两侧取积分，假设下限是某一时刻 $t_0$，那么
$$
\int_{t_0}^{t} \dfrac{\mathrm{d}}{\mathrm{d} t} \left(e^{-At}h(t) \right) \mathrm{d} t = e^{-At}h(t) \Big\vert_{t_0}^{t} = 
e^{-At}h(t) - e^{-At_0}h(t_0)
= 0
$$
把这个等式左右同时除以 $e^{-At}$ 并移项整理，就有
$$
h(t)=e^{A(t-t_0)} h(t_0)
$$
太棒了！我们已经求出了在 $B=0$ 条件下的解，接下来在 $B \neq 0$ 的条件下怎么办呢？

我们再重新写出微分方程
$$
\dfrac{\mathrm{d} h}{\mathrm{d} t} = A h(t) + B x(t)
$$
沿用上面的思想，我们本质上就是在方程两侧同时乘 $e^{-At}$，得
$$
e^{-At} \dfrac{\mathrm{d} h}{\mathrm{d} t} - A e^{-At} h(t) = B e^{-At} x(t)
$$
然后，两侧同时积分
$$
\int_{t_0}^{t} \dfrac{\mathrm{d}}{\mathrm{d} t} \left(e^{-At}h(t) \right) \mathrm{d} t = \int_{t_0}^{t} e^{A(t-\tau)} B x(t) \mathrm{d}\tau
$$
根据我们在 $B=0$ 条件下的特解，等号左侧可以直接代换为
$$
e^{-At}h(t) - e^{-At_0}h(t_0) = \int_{t_0}^{t} e^{A(t-\tau)} B x(\tau) \mathrm{d}\tau
$$
再把这个等式左右同时除以 $e^{-At}$ 并移项整理，就有
$$
h(t) = e^{A(t-t_0)} h(t_0) + \int_{t_0}^{t} e^{A(t-\tau)} B x(\tau) \mathrm{d}\tau
$$
至此，我们得到了原来微分方程的通解. 

> 笔者注：数学就是这样，光看是不行的（包括光看我的这个推导），只有自己动笔才能真正理解背后的思想. 
